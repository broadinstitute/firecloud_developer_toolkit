#!/bin/bash

instancename=$1
imagename=$2
# todo - edit this script and the initial setup script to append "-disk" to the disk names. also the create script.
# todo - error checking on imagename validity, 
# todo checking that images created successfully before deleting sounce disks

gcloud compute instances stop $instancename


#gcloud compute instances set-disk-auto-delete $instancename --no-auto-delete --disk $instancename
#gcloud compute instances set-disk-auto-delete $instancename --no-auto-delete --disk ${instancename}-aux

# add the -q flag to make it not prompt
gcloud compute instances delete $instancename --keep-disks=all -q

gcloud compute images create $imagename --source-disk $instancename
gcloud compute images create ${imagename}-aux --source-disk ${instancename}-aux

# the disks can be deleted once you are sure you are done imaging them.
# gcloud compute disks delete $instancename $instancename
# gcloud compute disks delete $instancename ${instancename}-aux


